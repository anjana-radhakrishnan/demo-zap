version: 2.1
jobs:
  scan:
    docker:
      - image: owasp/zap2docker-stable
    steps:
      - run:
            command: |
              mkdir /zap/wrk
              zap-api-scan.py -t "https://gitlab.cloudifyops.com/api/v4/projects/314" -f openapi --hook=/zap/auth_hook.py -z "auth.api=KAzsZwr5Ubvx_qzCJqYx" -g gen.conf -I -r testreport.html
      - store_artifacts:
          path: /zap/wrk
          destination: zap-report
          
workflows:
  scan-workflow:
    jobs:
      - scan
